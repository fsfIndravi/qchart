/*! QChart | Â© 2018 Denis Seleznev | MIT License | https://github.com/hcodes/qchart/ */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.QChart=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function e(t,e){var i=document.createElement(e||"div");return i.className="qchart__"+t,i}function i(t,e,i){"number"==typeof i&&(i+="px"),t.style[e]=i}function r(e,r,n){"object"===(void 0===r?"undefined":t(r))?Object.keys(r).forEach(function(t){i(e,t,r[t])}):i(e,r,n)}function n(t){var e=void 0,i=void 0;e=i=t[0][1];for(var r=0;r<t.length;r++)e=Math.min(e,t[r][1]),i=Math.max(i,t[r][1]);return{min:e,max:i}}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._eventBuffer=[]}return o(t,[{key:"on",value:function(t,e){return t&&e&&this._eventBuffer.push({type:t,callback:e}),this}},{key:"off",value:function(t,e){for(var i=this._eventBuffer,r=0;r<i.length;r++)e===i[r].callback&&t===i[r].type&&(i.splice(r,1),r--);return this}},{key:"trigger",value:function(t,e){for(var i=this._eventBuffer,r=0;r<i.length;r++)t===i[r].type&&i[r].callback.call(this,{type:t},e);return this}},{key:"destroy",value:function(){delete this._eventBuffer}}]),t}(),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._defaultOptions={backgroundColor:"#000",height:300,lineWidth:1,scrollAlign:"right",period:"all",periods:[{value:"all",text:"All"},{value:"year",text:"Year",days:365},{value:"quarter",text:"Quarter",days:91},{value:"month",text:"Month",days:30}],middleLineWidth:2,middleLineColor:"#FFD963",middleDotBorderWidth:2,middleDotSize:5,middleDotBackgroundColor:"#000",color:"#FFF",color0:"#FFD963",color1:"#FD5A3E",color2:"#97CC64",color3:"#77B6E7",color4:"#A955B8",dateFormater:function(t){var e=new Date(t);function i(t){return t>9?t:"0"+t}return[e.getFullYear(),i(e.getMonth()+1),i(e.getDate())].join("-")},valueFormater:function(t){return t}},this._options=e||{}}return a(t,[{key:"get",value:function(t){var e=this._options[t];return void 0===e?this._defaultOptions[t]:e}},{key:"set",value:function(t,e){this._options[t]=e}},{key:"destroy",value:function(){delete this._options}}]),t}(),h=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();var f=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$main=e,this.options=i,this.$dots=[]}return h(t,[{key:"create",value:function(t){this.remove();for(var i=0;i<t.length;i++){var r=e("middle-dot");this.$main.appendChild(r),this.$dots.push(r)}this.setStyle(t)}},{key:"setStyle",value:function(t){var e=this.options.get("middleDotSize"),i=-this.options.get("middleDotSize")/2-this.options.get("middleDotBorderWidth"),n=this.options.get("middleDotBackgroundColor"),o=this.options.get("middleDotBorderWidth");this.$dots.forEach(function(s,a){r(s,{borderColor:t[a]||this.options.get("color"+a),borderWidth:o,backgroundColor:n,marginLeft:i,marginTop:i,width:e,height:e})},this)}},{key:"setTop",value:function(t){this.$dots.forEach(function(e,i){r(e,"top",t[i])})}},{key:"remove",value:function(){this.$dots.forEach(function(t){t.parentNode.removeChild(t)}),this.$dots=[]}},{key:"destroy",value:function(){this.remove(),delete this.options,delete this.$main}}]),t}(),d=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();var l=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$main=e,this.options=i,this._values=[]}return d(t,[{key:"create",value:function(t){this.remove(),this.$date=e("current-date"),this.$main.appendChild(this.$date);var i=e("current-values");this.$main.appendChild(i);for(var r=0;r<t.length;r++){var n=e("current-value");i.appendChild(n),this._values.push(n)}this.setStyle(t)}},{key:"setStyle",value:function(t){var e=this;this._values.forEach(function(i,n){r(i,"color",t[n]||e.options.get("color"+n))})}},{key:"setValues",value:function(t,e){var i=this;this._values.forEach(function(e,r){e.innerHTML=i.options.get("valueFormater")(t[r],r)}),this.$date.innerHTML=this.options.get("dateFormater")(e)}},{key:"remove",value:function(){this._values.forEach(function(t){return t.parentNode.removeChild(t)}),this._values=[]}},{key:"destroy",value:function(){this.remove(),delete this._values,delete this.options,delete this.$main}}]),t}(),c=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}return function(t){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var r=v(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return(t="string"==typeof t?document.querySelector(t):t)?(r.$dom=t,r.$dom.classList.add("qchart"),r.options=new u(e),r._period=r.options.get("period"),r._periodsByValue=(r.options.get("periods")||[]).reduce(function(t,e){return t[e.value]=e,t},{}),r._createBody(),r.updateOptions(),r._data=r._getEmptyData(),r._buffers=[],r._buffersWidth=r.$buffers.offsetWidth,r._buffersHeight=r.$buffers.offsetHeight,r._cachedAreaWidth=1.1*r._buffersWidth,r._bindEvents(),r):v(r)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,s),c(i,[{key:"destroy",value:function(){this._removeAllBuffers(),this._unbindEvents(),this.options.destroy(),this._middleDots.destroy(),this._currentValues.destroy(),delete this.$periods,this.$dom.innerHTML="",delete this.$dom}},{key:"_getEmptyData",value:function(){return{series:[]}}},{key:"clearData",value:function(){this.setData(this._getEmptyData())}},{key:"setData",value:function(t){var e=this;if(this._removeAllBuffers(),!(t&&Array.isArray(t.series)&&t.series.length))return this.$dom.classList.remove("_has-data"),this._middleDots.remove(),this._currentValues.remove(),void(this._data=this._getEmptyData());this.$dom.classList.add("_has-data"),this._data=t,this._updateDataWidth(),this._updateScrollAlign();var i=this._data.series,o=i.map(function(t,i){return t.color||e.options.get("color"+i)});this._middleDots.create(o),this._currentValues.create(o),r(this.$dom,"color",this.options.get("color"+(1===i.length?"0":""))),this._addBuffers(),this._minMax=function(t){var e=n(t[0].data),i=e.min,r=e.max;if(t.length>1)for(var o=0;o<t.length;o++){var s=n(t[o].data);i=Math.min(s.min,i),r=Math.max(s.max,r)}return{min:i,max:r}}(i),this.draw()}},{key:"setPeriod",value:function(t){if(t!==this._period){this.trigger("changeperiod",t),this._period=t;var e=this.$periods.querySelector("._selected");e&&e.classList.remove("_selected");var i=this.$periods.querySelector("._value_"+t);i&&i.classList.add("_selected"),this.update()}}},{key:"resize",value:function(){var t=this.$buffers.offsetWidth,e=this.$buffers.offsetHeight;t===this._buffersWidth&&e===this._buffersHeight||(this._buffersWidth=t,this._bufferHeight=e,this.update(),this.trigger("resize"))}},{key:"scroll",value:function(){this.draw(),this.trigger("scroll")}},{key:"updateOptions",value:function(){r(this.$dom,{backgroundColor:this.options.get("backgroundColor"),color:this.options.get("color")}),r(this.$middleLine,{backgroundColor:this.options.get("middleLineColor"),width:this.options.get("middleLineWidth"),marginLeft:-this.options.get("middleLineWidth")/2}),r(this.$buffers,"height",this.options.get("height")),this._updateBuffersPadding()}},{key:"update",value:function(){this._updateDataWidth(),this._updateBuffersPadding(),this._removeAllBuffers(),this._addBuffers(),this.draw()}},{key:"draw",value:function(){var t=this,e=this.$buffers.scrollLeft,i=this._data.series;this._buffers.forEach(function(t,i){var r,n,o,s;r=t.left,n=t.left+this._buffersWidth,o=e-this._cachedAreaWidth,s=e+this._cachedAreaWidth,r>o&&r<s||n>o&&n<s?!t.canvas&&this._drawBuffer(t,i):this._removeBuffer(t)},this);var r=Math.floor((e+this._buffersWidth/2-this._buffersPadding)/this._getScale());r<0&&(r=0);var n=void 0,o=i.map(function(t){var e=t.data.length-1,i=r;return i>e&&(i=e),n=t.data[i][0],t.data[i][1]});this._currentValues.setValues(o,n),this._middleDots.setTop(o.map(function(e){return t._calcY(e)}))}},{key:"_drawBuffer",value:function(t,i){var n=t.canvas;n||(t.canvas=n=e("buffer","canvas"),n.width=t.width,n.height=t.height,r(n,"left",t.left),this.$buffersContainer.appendChild(n));var o=t.canvas.getContext("2d"),s=this._getScale();o.fillStyle=this.options.get("backgroundColor"),o.fillRect(0,0,t.width,t.height),o.lineWidth=this.options.get("lineWidth");for(var a=0;a<this._data.series.length;a++){var u=this._data.series[a].data;o.strokeStyle=u.color||this.options.get("color"+a),o.beginPath();for(var h=0;h<u.length;h++){var f=h*s-i*this._buffersWidth,d=this._calcY(u[h][1]);if(h?o.lineTo(f,d):o.moveTo(f,d),f>this._buffersWidth)break}o.stroke()}}},{key:"_createBody",value:function(){var t=e("current");this.$dom.appendChild(t),this._currentValues=new l(t,this.options);var i=e("container");this.$dom.appendChild(i),this.$middleLine=e("middle-line"),i.appendChild(this.$middleLine);var r=e("middle-dots");i.appendChild(r),this._middleDots=new f(r,this.options),this.$buffers=e("buffers"),i.appendChild(this.$buffers),this.$buffersContainer=e("buffers-container"),this.$buffers.appendChild(this.$buffersContainer),this._createPeriods()}},{key:"_createPeriods",value:function(){var t=this,i=this.options.get("periods");i&&(this.$periods=e("periods"),i.forEach(function(i){var r=e("period");r.dataset.value=i.value,r.innerHTML=i.text,r.classList.add("_value_"+i.value),t._period===i.value&&r.classList.add("_selected"),t.$periods.appendChild(r)}),this.$dom.appendChild(this.$periods))}},{key:"_bindEvents",value:function(){var t=this;this._onresize=this.resize.bind(this),this._onscroll=this.scroll.bind(this),this._onclickperiod=function(e){var i=e.target.dataset.value;i&&t.setPeriod(i)},this.$periods&&this.$periods.addEventListener("click",this._onclickperiod,!1),this.$buffers.addEventListener("scroll",this._onscroll,!1),window.addEventListener("resize",this._onresize,!1)}},{key:"_unbindEvents",value:function(){this.$periods&&this.$periods.removeEventListener("click",this._onclickperiod,!1),this.$buffers.removeEventListener("scroll",this._onscroll,!1),window.removeEventListener("resize",this._onresize,!1)}},{key:"_calcY",value:function(t){return this._buffersHeight-t*this._buffersHeight/this._minMax.max}},{key:"_addBuffers",value:function(){for(var t=this._getCountBuffers(),e=0;e<t;e++)this._buffers.push({left:e*this._buffersWidth,width:this._buffersWidth,height:this._buffersHeight,canvas:null});this._buffers[t-1].width=this._dataWidth-(t-1)*this._buffersWidth}},{key:"_removeBuffer",value:function(t){t.canvas&&(this.$buffersContainer.removeChild(t.canvas),t.canvas=null)}},{key:"_removeAllBuffers",value:function(){this._buffers.forEach(function(t){this._removeBuffer(t)},this),this._buffers=[]}},{key:"_getCountBuffers",value:function(){var t=this._dataWidth/this.$buffers.offsetWidth,e=Math.floor(t);return t===e?t:e+1}},{key:"_getScale",value:function(){var t=this.$buffers.offsetWidth;return"all"===this._period?t/this._data.series[0].data.length:t/this._periodsByValue[this._period].days}},{key:"_updateBuffersPadding",value:function(){this._buffersPadding=this.$buffers.offsetWidth/2,r(this.$buffersContainer,{marginLeft:this._buffersPadding,paddingRight:this._buffersPadding})}},{key:"_updateDataWidth",value:function(){this._dataWidth=this._data.series[0].data.length*this._getScale(),r(this.$buffersContainer,"width",this._dataWidth)}},{key:"_updateScrollAlign",value:function(){var t=this.options.get("scrollAlign");this.$buffers.scrollLeft="right"===t?this.$buffersContainer.offsetWidth+2*this._buffersPadding-this.$buffers.offsetWidth:0}}]),i}()});