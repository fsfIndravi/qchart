/*! QChart | Â© 2018 Denis Seleznev | MIT License | https://github.com/hcodes/qchart/ */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.QChart=t()}(this,function(){"use strict";var e=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="qchart",this._elems={main:e},this._main=e}return e(t,[{key:"create",value:function(e,t){var i=document.createElement(t||"div");return i.className=this.name+"__"+e,i}},{key:"append",value:function(e,t){t?t.appendChild(e):this._main.appendChild(e)}},{key:"destroy",value:function(){this._main.innerHTML="",delete this._main}}]),t}(),i=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._defaultOptions={backgroundColor:"black",color:"yellow",height:300,scale:1,middleLineWidth:2,middleLineBackgroundColor:"yellow",middleDotBorderWidth:2,middleDotBorderColor:2,middleDotSize:5,middleDotBackgroundColor:"black"},this._options=t||{}}return i(e,[{key:"get",value:function(e){var t=this._options[e];return void 0===t?this._defaultOptions[e]:t}},{key:"set",value:function(e,t){this._options[e]=t}},{key:"destroy",value:function(){delete this._options}}]),e}();var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var o=function(){function e(i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._elem=i,this._buffers=[],this.clearData(),this.options=s,this.elems=new t(i),this._width=i.offsetWidth,this._height=i.offsetHeight,this._cachedAreaWidth=1.5*this._width,this._buffersContainer=this.elems.create("buffers-container"),this.elems.append(this._buffersContainer),this.bindEvents(),this.update()}return n(e,[{key:"bindEvents",value:function(){var e=this;this._onresize=function(){e.resize()},this._onscroll=function(){e.scroll()},this._elem.addEventListener("scroll",this._onscroll,!1),window.addEventListener("resize",this._onresize,!1)}},{key:"unbindEvents",value:function(){this._elem.removeEventListener("scroll",this._onscroll,!1),window.removeEventListener("resize",this._onresize,!1)}},{key:"clearData",value:function(){this._data={series:[]}}},{key:"setData",value:function(e){if(this.removeAllBuffers(),e&&Array.isArray(e.series)&&e.series.length){this._data=e,this._dataWidth=this._data.series[0].length*this.options.get("scale"),this._buffersContainer.style.width=this._dataWidth+"px";for(var t=this.getCountBuffers(),i=0;i<t;i++)this._buffers.push({left:i*this._width,width:this._width,height:this._height,canvas:null});this._buffers[t-1].width=this._dataWidth-(t-1)*this._width,this._minMax=function(e){var t=void 0,i=void 0;t=i=e[0][1];for(var s=0;s<e.length;s++)t=Math.min(t,e[s][1]),i=Math.max(i,e[s][1]);return{min:t,max:i}}(this._data.series[0]),this.draw()}else this.clearData()}},{key:"draw",value:function(){var e=this._elem.scrollLeft,t=e-this._cachedAreaWidth,i=e+this._cachedAreaWidth;this._buffers.forEach(function(e,s){var n=e.left,o=e.left+this._width;n>t&&n<i||o>t&&o<i?!e.canvas&&this.drawBuffer(e,s):this.removeBuffer(e)},this)}},{key:"drawBuffer",value:function(e,t){var i=e.canvas;i||(e.canvas=i=this.elems.create("buffer","canvas"),i.width=e.width,i.height=e.height,i.style.left=e.left+"px",this._buffersContainer.appendChild(i));var s=e.canvas.getContext("2d"),n=this.options.get("scale"),o=this._data.series[0];s.fillStyle="black",s.fillRect(0,0,e.width,e.height),s.beginPath(),s.strokeStyle="yellow",s.lineWidth=1;for(var r=0;r<o.length;r++){var h=r*n-t*this._width,a=this._height-o[r][1]*this._height/this._minMax.max;r?s.lineTo(h,a):s.moveTo(h,a)}s.stroke()}},{key:"removeBuffer",value:function(e){e.canvas&&(this._buffersContainer.removeChild(e.canvas),e.canvas=null)}},{key:"removeAllBuffers",value:function(){this._buffers.forEach(function(e){this.removeBuffer(e)},this),this._buffers=[]}},{key:"getCountBuffers",value:function(){var e=this._dataWidth/this._elem.offsetWidth,t=Math.floor(e);return e===t?e:t+1}},{key:"scroll",value:function(){this.draw()}},{key:"resize",value:function(){var e=this._elem.offsetWidth,t=this._elem.offsetHeight;e===this._width&&t===this._height||(this._width=e,this._height=t,this.update())}},{key:"update",value:function(){this.removeAllBuffers(),this.draw();var e=this._elem.offsetWidth/2;this._buffersContainer.style.marginLeft=e+"px",this._buffersContainer.style.paddingRight=e+"px"}},{key:"destroy",value:function(){this.removeAllBuffers(),this.unbindEvents()}}]),e}(),r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();return function(){function e(i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(i="string"==typeof i?document.querySelector(i):i)&&(this._dom=i,this.elems=new t(i),this.options=new s(n),this.createBody(),this.updateOptions(),this.scales={year:2.5,month:5,day:10},this.manager=new o(this._manager,this.options))}return r(e,[{key:"setStyle",value:function(e,t,i){"number"==typeof i&&(i+="px"),e.style[t]=i}},{key:"createBody",value:function(){this._info=this.elems.create("info"),this.elems.append(this._info);var e=this.elems.create("container");this.elems.append(e),this._middleLine=this.elems.create("middle-line"),this.setStyle(this._middleLine,"backgroundColor",this.options.get("middleLineBackgroundColor")),this.setStyle(this._middleLine,"width",this.options.get("middleLineWidth")),this.setStyle(this._middleLine,"marginLeft",-this.options.get("middleLineWidth")/2),this.elems.append(this._middleLine,e),this._middleDot=this.elems.create("middle-dot"),this.setStyle(this._middleDot,"borderWidth",this.options.get("middleDotBorderWidth")),this.setStyle(this._middleDot,"borderColor",this.options.get("middleDotBorderColor")),this.setStyle(this._middleDot,"backgroundColor",this.options.get("middleDotBackgroundColor")),this.setStyle(this._middleDot,"width",this.options.get("middleDotSize")),this.setStyle(this._middleDot,"marginLeft",-this.options.get("middleDotSize")/2-this.options.get("middleDotBorderWidth")),this.setStyle(this._middleDot,"height",this.options.get("middleDotSize")),this.elems.append(this._middleDot,e),this._manager=this.elems.create("manager"),this.setStyle(this._manager,"height",this.options.get("height")),this.elems.append(this._manager,e),this._controls=this.elems.create("controls"),this.elems.append(this._controls)}},{key:"setData",value:function(e){e.series.length?this._dom.classList.remove("_has-data"):this._dom.classList.add("_has-data"),this.manager.setData(e)}},{key:"redraw",value:function(){this.updateOptions(),this.resize()}},{key:"updateOptions",value:function(){["backgroundColor","color"].forEach(function(e){this.setStyle(this._dom,e,this.options.get(e))},this),this.setStyle(this._manager,"height",this.options.get("height"))}},{key:"destroy",value:function(){this.elems.destroy(),this.options.destroy(),delete this._dom}}]),e}()});